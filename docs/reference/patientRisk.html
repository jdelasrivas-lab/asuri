<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>patientRisk — patientRisk • asuri</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="patientRisk — patientRisk"><meta name="description" content="This function selects a subset of good risk markers and estimates a multivariate risk score based on the UNICOX algorithm. The patients are stratified into two or more prognostic groups based on the risk score. The Cox regression is trained using a ten-fold double nested crossvalidation strategy to avoid overfitting."><meta property="og:description" content="This function selects a subset of good risk markers and estimates a multivariate risk score based on the UNICOX algorithm. The patients are stratified into two or more prognostic groups based on the risk score. The Cox regression is trained using a ten-fold double nested crossvalidation strategy to avoid overfitting."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">asuri</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/asuri.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jdelasrivas-lab/asuri/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>patientRisk</h1>

      <div class="d-none name"><code>patientRisk.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function selects a subset of good risk markers and estimates a multivariate risk score based on the UNICOX algorithm. The patients are stratified into two or more prognostic groups based on the risk score. The Cox regression is trained using a ten-fold double nested crossvalidation strategy to avoid overfitting.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">patientRisk</span><span class="op">(</span><span class="va">mExpr</span>, <span class="va">time</span>, <span class="va">status</span>, </span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min.pval"</span>, <span class="st">"med.pval"</span>, <span class="st">"class.probs"</span><span class="op">)</span>, nboot <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-mexpr">mExpr<a class="anchor" aria-label="anchor" href="#arg-mexpr"></a></dt>
<dd><p>A numeric matrix of gene expression data where each row represents a gene and each column represents a sample.</p></dd>

  <dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>A numeric vector representing the survival time for each sample, names(time) should be defined as the sample names.</p></dd>

  <dt id="arg-status">status<a class="anchor" aria-label="anchor" href="#arg-status"></a></dt>
<dd><p>A numeric vector representing the event status (1 = event, 0 = censored) for each sample, names(status) should be defined as the sample names.</p></dd>

  <dt id="arg-group-vector">group.vector<a class="anchor" aria-label="anchor" href="#arg-group-vector"></a></dt>
<dd><p>A numeric vector specifying predefined risk groups for the patients. This is optional.</p></dd>

   <dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>A character string specifying the method for defining risk groups. Possible options are:</p><ul><li><p><code>"min.pval"</code>: Defines risk groups based on the minimum log-rank p-value.</p></li>
<li><p><code>"med.pval"</code>: Defines risk groups based on the median of the log-rank p-values.</p></li>
<li><p><code>"class.probs"</code>: Defines risk groups based on the classification probabilities from the model.</p></li>
</ul><p>If <code>NULL</code>, the default method is <code>"class.probs"</code>.</p></dd>

  <dt id="arg-nboot">nboot<a class="anchor" aria-label="anchor" href="#arg-nboot"></a></dt>
<dd><p>An integer specifying the number of bootstrap iterations for risk score calculation. Default is 50.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>A multivariate Cox regression is trained to select a subset of genes significantly associated with the risk and to estimate a risk score based on these risk markers.
The algorithm considered is based on UNICOX, a regularized multivariate Cox regression model (see Tibshirani et al., 2009 for more details). In this predictor, the variables are penalized individually using an \(L_1\) norm term which allow us to keep more relevant genes correlated with risk than in Lasso. The Lasso model selects only one representative gene randomly from the set of correlated genes. The optimal value for the lambda parameter as well as the risk score are estimated using a double nested crossvalidation strategy. Finally, the risk score allow us to stratify the whole set of patients according to their risks. Three algorithms are implemented to estimate the optimal threshold that classifies the patients in risk groups. "min.pval" determines the optimal threshold by minimization of the log-rank p-value statistics, that is by  maximization of the separability between the K-M curves for the high and low risk groups, see  (Martinez-Romero et al., 2018). When several local minima arise this may be sample dependent and unstable. To avoid this problem, "med.pval" estimates the optimal threshold as the median of the lower 10th percentile logrank p-values. The lower 10th percentile selects the smallest values from the p-value distribution corresponding to intermediate risk patients that are on the boundary between both groups. This interval is more robust than a single minimum and provides good experimental results for a large variety of problems tested. The median threshold in this interval may change from one iteration to another because the distribution of p-values for patients with intermediate risk may change due to sample variations. Finally, "class.probs" implements a bootstrap strategy for the patients corresponding to the lower 10th percentile p-values and estimates a robust threshold to stratify the patients. It estimates also a membership probability of classification.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function generate 5 plots:</p>
<dl><dt>•</dt>
<dd><p>Curve of log-rank p-values for each possible splitting of patients in two risk groups considering their risk score. The green line shows the robust minimum selected which provides a threshold to stratify the patients in two risk groups. The blue/red lines show the thresholds to stratify the patients in three risk groups (low, intermediate and high).</p></dd>

  <dt>•</dt>
<dd><p>Risk plot obtained by a multivariate Cox regression model (UNICOX) considering the optimal subset of genes correlated with the risk. The green and blue/red lines show the thresholds to stratify the patients in two or three risk groups respectively.</p></dd>

  <dt>•</dt>
<dd><p>Log-rank p-value versus number of genes selected by the model.</p></dd>

  <dt>•</dt>
<dd><p>Genes ranked by the value of the regression coefficients in the multivariate Cox model (UNICOX). Genes with a significant p-value are marked with asterisks following the standard statistical convention. Similarly, genes with a significance level between 0.1 and 0.05 are marked with a period.</p></dd>

  <dt>•</dt>
<dd><p>Kaplan Meier plot: Blue (low risk) and red (high risk). Risk groups are obtained from the stratification of the risk curve (plot 2).</p></dd>
 </dl><p><br>
  The function also returns an object containing:</p>
<dl><dt>cv_risk_score</dt>
<dd><p>Risk score prediction for the training set using a double nested crossvalidated strategy</p></dd>

  <dt>cv_normalized_risk</dt>
<dd><p>Normalized risk score in the interval (0,100).</p></dd>

  <dt>table_genes_selected</dt>
<dd><p>Data frame with the following columns: The names for the genes selected by the Cox regression, the beta coefficients for the optimal multivariate Cox regression fitted to the training set, the Hazard Ratio for each gene and the p-value for the univariate log-rank statistical test. Genes are shown by descending order of the HR index.</p></dd>

  <dt>table_genes_selected_extended</dt>
<dd><p>Table with the same format as table_genes_selected. A search for local minima within a 5% range of the selected minimum is performed. The goal is expanding the list of significant genes to improve biological interpretability, since the lasso penalty drastically reduces the number of significant genes.</p></dd>

  <dt>model.optimalLambda</dt>
<dd><p>The fitted model for the optimal regularization parameter.</p></dd>

  <dt>groups</dt>
<dd><p>Vector of classification of patients in two risk groups, high (2) or low (1).</p></dd>

  <dt>riskThresholds</dt>
<dd><p>Thresholds that allows to stratify the test patients in three groups according to the predicted risk score: low, intermediate and high risk.</p></dd>

  <dt>range.risk</dt>
<dd><p>Range of the unscaled risk score in the training set.</p></dd>

  <dt>list.models</dt>
<dd><p>List of models tested for different values of the regularization parameter.</p></dd>

  <dt>evaluation.models</dt>
<dd><p>Data frame that provides several metrics for each model evaluated. The lambda column provides the regularization parameter for the multivariate Cox regression adjusted, the number_features gives the number of genes selected by this model, c.index and se.c.index the concordance index and the standard deviation for the risk prediction and finally, the p_value_c.index and the logrank_p_value give the p-values for the the concordance index and the log-rank statistics respectively. Models are shown by ascending order of the log-rank p-value and the best one is marked with two asterisks.</p></dd>

  <dt>betasplot</dt>
<dd><p>Dataset used to create the plot of genes ranked according to the regression coefficients in the multivariate Cox model (UNICOX).</p></dd>

  <dt>plot_values</dt>
<dd><p>A list containing Kaplan-Meier fit results, logrank p-value, and hazard ratio.</p></dd>

  <dt>membership_prob</dt>
<dd><p>If method "class.probs" is selected a table with two columns is returned. The first one is the probability of classification to the low risk group while the second one is the membership probability to the high risk group.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Martinez-Romero, J., Bueno-Fortes, S., Martín-Merino, M. <em>et al.</em> (2018) <b>Survival marker genes of colorectal cancer derived from consistent transcriptomic profiling</b>. <em>BMC Genomics</em> 19 (Suppl 8), 857 . <a href="https://doi.org/10.1186/s12864-018-5193-9" class="external-link">doi:10.1186/s12864-018-5193-9</a></p>
<p>Santiago Bueno-Fortes, Alberto Berral-Gonzalez, José Manuel Sánchez-Santos, Manuel Martin-Merino, Javier De Las Rivas (2023) <b>Identification of a gene expression signature associated with breast cancer survival and risk that improves clinical genomic platforms</b>, <em>Bioinformatics Advances</em>, Volume 3, Issue 1, vbad037, <a href="https://doi.org/10.1093/bioadv/vbad037" class="external-link">doi:10.1093/bioadv/vbad037</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">matrixData</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>data set ‘matrixData’ not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The TIME value must be transformed to YEARS</span></span></span>
<span class="r-in"><span><span class="co">## Names of time and status vectors are the sample names</span></span></span>
<span class="r-in"><span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">mPheno</span><span class="op">$</span><span class="va">time</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'mPheno' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mPheno</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'x' in selecting a method for function 'rownames': object 'mPheno' not found</span>
<span class="r-in"><span><span class="va">status</span> <span class="op">&lt;-</span> <span class="va">mPheno</span><span class="op">$</span><span class="va">status</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'mPheno' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">status</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mPheno</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'x' in selecting a method for function 'rownames': object 'mPheno' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pred_Er.IHC$genes is the subset of genes to be tested. In our case study it is the list of genes</span></span></span>
<span class="r-in"><span><span class="co"># related to the ER clinical variable obtained by function genePheno. It can be any subset of genes</span></span></span>
<span class="r-in"><span><span class="co"># to analyze the relationship with survival.</span></span></span>
<span class="r-in"><span><span class="va">geneList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Pred_ER.IHC</span><span class="op">$</span><span class="va">genes</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'Pred_ER.IHC' not found</span>
<span class="r-in"><span><span class="co"># Next, the expression matrix for the list of genes selected is obtained.</span></span></span>
<span class="r-in"><span><span class="va">mExprSelectedGenes</span> <span class="op">&lt;-</span> <span class="va">mExprs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">geneList</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mExprs</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> </span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'mExprs' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Training of the multivariate Cox model.</span></span></span>
<span class="r-in"><span><span class="co"># You have to provide: the expression matrix (genes as rows and samples as columns) for the list of genes selected, the time and status vectors.</span></span></span>
<span class="r-in"><span><span class="va">multivariate_risk_predictor</span> <span class="op">&lt;-</span> <span class="fu">patientRisk</span><span class="op">(</span><span class="va">mExprSelectedGenes</span>, <span class="va">time</span>, <span class="va">status</span>, method <span class="op">=</span> <span class="st">"class.probs"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'mExprSelectedGenes' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate the plots again</span></span></span>
<span class="r-in"><span><span class="fu">asuri</span><span class="fu">:::</span><span class="fu">plotLogRank</span><span class="op">(</span><span class="va">multivariate_risk_predictor</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'multivariate_risk_predictor' not found</span>
<span class="r-in"><span><span class="fu">asuri</span><span class="fu">:::</span><span class="fu">plotSigmoid</span><span class="op">(</span><span class="va">multivariate_risk_predictor</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'multivariate_risk_predictor' not found</span>
<span class="r-in"><span><span class="fu">asuri</span><span class="fu">:::</span><span class="fu">plotLambda</span><span class="op">(</span><span class="va">multivariate_risk_predictor</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'multivariate_risk_predictor' not found</span>
<span class="r-in"><span><span class="fu">asuri</span><span class="fu">:::</span><span class="fu">plotBetas</span><span class="op">(</span><span class="va">multivariate_risk_predictor</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'multivariate_risk_predictor' not found</span>
<span class="r-in"><span><span class="fu">asuri</span><span class="fu">:::</span><span class="fu">plotKM</span><span class="op">(</span><span class="va">multivariate_risk_predictor</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'multivariate_risk_predictor' not found</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alberto Berral-Gonzalez, Santiago Bueno-Fortes, Natalia Alonso-Moreda, Jose Manuel Sanchez-Santos, Manuel Martin-Merino Acera, Javier De Las Rivas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

